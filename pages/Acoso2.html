<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Interseccional Din√°mico</title>
    <style>
        /* --- ESTILOS GENERALES --- */
        :root {
            --primary: #2c3e50;
            --accent: #e67e22;
            --bg: #ecf0f1;
            --white: #ffffff;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #c0392b;
            --radius: 16px;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--primary);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Evita scroll en el body principal */
        }

        #app-container {
            width: 100%;
            max-width: 950px; /* Un poco m√°s ancho para PC */
            height: 95vh;
            max-height: 750px;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- SLIDES SYSTEM --- */
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            padding: 1.5rem; /* Padding reducido */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.5s cubic-bezier(0.2, 0, 0.2, 1), opacity 0.5s;
            opacity: 0;
            transform: translateX(50px);
            pointer-events: none;
            background: white;
            z-index: 1;
        }

        .slide.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
            z-index: 2;
        }

        .slide.exit {
            transform: translateX(-50px);
            opacity: 0;
        }

        /* --- UI ELEMENTS --- */
        h1, h2 { color: var(--primary); margin: 0 0 1rem 0; text-align: center; }
        p { color: #666; max-width: 600px; text-align: center; line-height: 1.5; margin-bottom: 1.5rem; }

        .btn-action {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3);
            transition: transform 0.2s;
            flex-shrink: 0; /* Evita que el bot√≥n se aplaste */
        }
        .btn-action:hover { transform: scale(1.05); }

        /* --- SIMULADOR GRID (LAYOUT INTELIGENTE) --- */
        .sim-layout {
            display: grid;
            grid-template-columns: 350px 1fr; /* Visual fijo izq, Controles derecha (o viceversa seg√∫n dise√±o) */
            /* En este caso pondremos: Controles Izq (Flexible) - Visual Der (Fijo) */
            grid-template-columns: 1fr 320px; 
            gap: 20px;
            width: 100%;
            height: 100%;
            overflow: hidden; /* Importante */
            padding-bottom: 20px;
        }

        /* AREA DE CONTROLES (IZQUIERDA) */
        .control-area {
            height: 100%;
            overflow-y: auto; /* SCROLL SOLO AQU√ç */
            padding-right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* Scrollbar bonito */
        .control-area::-webkit-scrollbar { width: 6px; }
        .control-area::-webkit-scrollbar-thumb { background-color: #bdc3c7; border-radius: 10px; }

        .control-group { background: #fdfdfd; padding: 8px; border-radius: 8px; border: 1px solid #f0f0f0; }
        .label { font-size: 0.7rem; font-weight: bold; color: #7f8c8d; margin-bottom: 6px; display: block; text-transform: uppercase; letter-spacing: 0.5px; }
        .options-row { display: flex; gap: 5px; flex-wrap: wrap; }
        
        .opt-btn {
            flex: 1;
            padding: 8px 10px; /* M√°s compacto */
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            white-space: nowrap; /* Evita saltos de l√≠nea dentro del bot√≥n */
            text-overflow: ellipsis;
            min-width: fit-content;
        }
        .opt-btn:hover { background: #f9f9f9; border-color: #bbb; }
        .opt-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 5px rgba(44, 62, 80, 0.2);
        }

        /* AREA VISUAL (DERECHA) */
        .sim-visual {
            background: #fdfdfd;
            border: 2px dashed #dcdcdc;
            border-radius: var(--radius);
            height: 100%;
            max-height: 100%; /* Ocupa el alto disponible */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Elementos desde arriba */
            padding: 20px;
            position: relative;
            box-sizing: border-box;
            overflow: hidden; /* Sin scrollbars aqu√≠ */
        }

        .avatar { 
            font-size: 5rem; 
            margin-bottom: 15px; 
            margin-top: 10px;
            transition: transform 0.3s; 
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1));
        }
        
        /* CONTENEDOR DE BADGES (TIPO NUBE) */
        .badge-container { 
            display: flex; 
            flex-wrap: wrap; /* CLAVE: Permite que bajen si no caben */
            justify-content: center;
            align-content: flex-start;
            gap: 6px; 
            width: 100%; 
            overflow: visible; /* No cortar sombras */
        }

        .badge {
            padding: 5px 10px;
            border-radius: 20px; /* M√°s redondos tipo 'Tag' */
            color: white;
            font-weight: 600;
            text-align: center;
            font-size: 0.7rem;
            opacity: 0;
            display: none; 
            transform: scale(0.9);
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .badge.visible { opacity: 1; transform: scale(1); display: inline-block; }
        
        /* Colores */
        .badge-gender { background: #8e44ad; }
        .badge-contract { background: #c0392b; }
        .badge-ethnic { background: #d35400; }
        .badge-territory { background: #27ae60; }
        .badge-peace { background: #2980b9; }
        .badge-care { background: #f39c12; }
        .badge-neuro { background: #16a085; }

        /* --- RESULTADO DIN√ÅMICO --- */
        .result-card {
            background: #f8f9fa;
            border-left: 6px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            width: 100%;
            text-align: left;
            animation: slideUp 0.5s ease;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .result-header { display: flex; align-items: center; gap: 15px; margin-bottom: 1rem; }
        .result-icon { font-size: 2rem; }
        .result-title { font-size: 1.2rem; color: #333; font-weight: bold; margin: 0; }
        .result-body { font-size: 0.95rem; color: #555; line-height: 1.5; }
        .tags { margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap; }
        .tag { font-size: 0.7rem; padding: 3px 8px; background: #e0e0e0; border-radius: 4px; color: #555; font-weight: bold; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- MEDIA QUERY (M√ìVIL) --- */
        @media (max-width: 768px) {
            #app-container { height: 100vh; border-radius: 0; max-height: none; }
            
            .sim-layout { 
                grid-template-columns: 1fr; /* Una sola columna */
                grid-template-rows: auto 1fr; /* Visual AUTO (Arriba), Controles FR (Abajo) */
                gap: 10px;
            }

            /* Visual arriba, peque√±o y fijo */
            .sim-visual {
                order: -1; /* Manda esto arriba visualmente */
                height: auto;
                min-height: 140px; /* Altura m√≠nima para avatar + badges */
                padding: 10px;
                border-bottom: 2px dashed #ddd;
                border: 2px dashed #dcdcdc; /* Borde completo se ve mejor */
                flex-direction: row; /* Avatar a la izq, badges a la derecha */
                justify-content: center;
                gap: 15px;
            }

            .avatar {
                font-size: 3.5rem; /* M√°s peque√±o en m√≥vil */
                margin: 0;
            }

            .badge-container {
                justify-content: flex-start; /* Alinear a la izq cerca del avatar */
                align-content: center;
                max-width: 70%; /* Espacio para badges */
            }

            .control-area {
                padding-bottom: 80px; /* Espacio extra abajo para que no se corte el √∫ltimo bot√≥n */
            }

            h2 { font-size: 1.2rem; margin-bottom: 0.5rem; }
            
            /* Ajuste botones opciones para que sean f√°ciles de tocar */
            .opt-btn { padding: 10px 5px; font-size: 0.75rem; }
            
            .result-header { flex-direction: column; text-align: center; }
            .result-card { text-align: center; }
            .tags { justify-content: center; }
        }
    </style>
</head>
<body>

<div id="app-container">
    
    <!-- SLIDE 1: PORTADA -->
    <div class="slide active" id="slide-1">
        <div style="font-size: 4rem; margin-bottom: 1rem;">‚öñÔ∏è</div>
        <h1>El Peso de las Estructuras</h1>
        <p>El acoso laboral y sexual no ocurre en el vac√≠o. Identifica c√≥mo las barreras para denunciar cambian seg√∫n qui√©n eres.</p>
        <button class="btn-action" onclick="goToSlide(2)">Comenzar Simulaci√≥n</button>
    </div>

    <!-- SLIDE 2: SIMULADOR -->
    <div class="slide" id="slide-2">
        <h2>Configura el Perfil</h2>
        
        <div class="sim-layout">
            
            <!-- CONTROLES (Ahora con scroll propio y ordenados) -->
            <div class="control-area">
                <!-- 1. G√âNERO -->
                <div class="control-group">
                    <span class="label">1. Identidad / Orientaci√≥n</span>
                    <div class="options-row">
                        <button class="opt-btn" onclick="selectOption('gender', 'male', this)">Hombre Cis</button>
                        <button class="opt-btn" onclick="selectOption('gender', 'female', this)">Mujer Cis</button>
                        <button class="opt-btn" onclick="selectOption('gender', 'lgbt', this)">LGBTIQ+</button>
                        <button class="opt-btn" onclick="selectOption('gender', 'intersex', this)">Intersexual</button>
                    </div>
                </div>
                
                <!-- 2. VINCULACI√ìN -->
                <div class="control-group">
                    <span class="label">2. Tipo de Vinculaci√≥n</span>
                    <div class="options-row">
                        <button class="opt-btn" onclick="selectOption('contract', 'public', this)">Servidor@ P√∫blic@</button>
                        <button class="opt-btn" onclick="selectOption('contract', 'contractor', this)">Contratista</button>
                        <button class="opt-btn" onclick="selectOption('contract', 'outsourced', this)">Tercerizado</button>
                    </div>
                </div>

                <!-- 3. ETNIA -->
                <div class="control-group">
                    <span class="label">3. Pertenencia √âtnica</span>
                    <div class="options-row">
                        <button class="opt-btn" onclick="selectOption('ethnic', 'no', this)">No</button>
                        <button class="opt-btn" onclick="selectOption('ethnic', 'yes', this)">S√≠, pertenece</button>
                    </div>
                </div>

                <!-- 4. TERRITORIAL -->
                <div class="control-group">
                    <span class="label">4. Enfoque Territorial</span>
                    <div class="options-row">
                        <button class="opt-btn" onclick="selectOption('territory', 'urban', this)">Urbano</button>
                        <button class="opt-btn" onclick="selectOption('territory', 'rural', this)">Rural</button>
                    </div>
                </div>

                <!-- 5. PAZ -->
                <div class="control-group">
                    <span class="label">5. Firmante de Paz</span>
                    <div class="options-row">
                        <button class="opt-btn" onclick="selectOption('peace', 'no', this)">No</button>
                        <button class="opt-btn" onclick="selectOption('peace', 'yes', this)">S√≠, firmante</button>
                    </div>
                </div>

                <!-- 6. CUIDADOR -->
                <div class="control-group">
                    <span class="label">6. Cuidador/a (Cabeza de Familia)</span>
                    <div class="options-row">
                        <button class="opt-btn" onclick="selectOption('caregiver', 'no', this)">No</button>
                        <button class="opt-btn" onclick="selectOption('caregiver', 'yes', this)">S√≠</button>
                    </div>
                </div>

                <!-- 7. NEURODIVERGENCIA -->
                <div class="control-group">
                    <span class="label">7. Neurodivergencia</span>
                    <div class="options-row">
                        <button class="opt-btn" onclick="selectOption('neuro', 'no', this)">No</button>
                        <button class="opt-btn" onclick="selectOption('neuro', 'yes', this)">S√≠</button>
                    </div>
                </div>
            </div>

            <!-- VISUAL (Fijo a la derecha en PC, Arriba en Celular) -->
            <div class="sim-visual">
                <div class="avatar" id="avatar-display">üë§</div>
                <div class="badge-container">
                    <div id="badge-gender" class="badge badge-gender">Diversidad/G√©nero</div>
                    <div id="badge-contract" class="badge badge-contract">Contrato Inestable</div>
                    <div id="badge-ethnic" class="badge badge-ethnic">Discrim. Racial</div>
                    <div id="badge-territory" class="badge badge-territory">Ruralidad</div>
                    <div id="badge-peace" class="badge badge-peace">Estigma Firmante</div>
                    <div id="badge-care" class="badge badge-care">Carga Cuidados</div>
                    <div id="badge-neuro" class="badge badge-neuro">Barrera Cognitiva</div>
                </div>
                
                <!-- El bot√≥n aparece dentro del visual pero al final -->
                <button id="btn-analyze" class="btn-action" style="margin-top: auto; display: none; background: var(--primary); width: 100%; font-size: 0.9rem;" onclick="generateAnalysis()">Diagnosticar Riesgo üîç</button>
            </div>
        </div>
    </div>

    <!-- SLIDE 3: RESULTADO -->
    <div class="slide" id="slide-3">
        <h2>Diagn√≥stico Estructural</h2>
        
        <div id="dynamic-result" class="result-card">
            <!-- JS llenar√° esto -->
        </div>

        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
            <button class="btn-action" onclick="goToSlide(4)">Continuar al Cierre</button>
            <button class="btn-action" style="background: transparent; color: #777; border: 1px solid #ccc;" onclick="goToSlide(2)">‚Üê Volver</button>
        </div>
    </div>

    <!-- SLIDE 4: CIERRE -->
    <div class="slide" id="slide-4">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üí°</div>
        <h1>Conclusi√≥n</h1>
        <p>La interseccionalidad demuestra que los protocolos "neutros" fallan porque las personas no son neutras. Quienes acumulan barreras (contractuales, de g√©nero, sociales) necesitan rutas de protecci√≥n reforzadas.</p>
        <button class="btn-action" onclick="location.reload()">Reiniciar Curso</button>
    </div>

</div>

<script>
    // ESTADO INICIAL
    let state = {
        gender: null,
        contract: null,
        ethnic: null,
        territory: null,
        peace: null,
        caregiver: null,
        neuro: null
    };

    // NAVEGACI√ìN
    function goToSlide(num) {
        document.querySelectorAll('.slide').forEach(s => {
            s.classList.remove('active');
            s.classList.add('exit');
        });
        const target = document.getElementById('slide-'+num);
        target.classList.remove('exit');
        setTimeout(() => target.classList.add('active'), 50);
    }

    // SELECCI√ìN DE OPCIONES
    function selectOption(category, value, btn) {
        state[category] = value;
        
        // Efecto bot√≥n seleccionado
        const siblings = btn.parentElement.children;
        for(let s of siblings) s.classList.remove('selected');
        btn.classList.add('selected');

        // Actualizar UI
        updateVisuals();

        // Verificar completitud
        const allSelected = Object.values(state).every(x => x !== null);
        
        const btnAnalyze = document.getElementById('btn-analyze');
        if(allSelected) {
            btnAnalyze.style.display = 'block';
            // Animaci√≥n peque√±a para llamar atenci√≥n
            btnAnalyze.animate([
                { transform: 'scale(1)' },
                { transform: 'scale(1.05)' },
                { transform: 'scale(1)' }
            ], { duration: 300 });
        }
    }

    function updateVisuals() {
        // Avatar
        const av = document.getElementById('avatar-display');
        let icon = 'üë§';
        if(state.gender === 'male') icon = 'üë®‚Äçüíº';
        else if(state.gender === 'female') icon = 'üë©‚Äçüíº';
        else if(state.gender === 'lgbt') icon = 'üè≥Ô∏è‚Äçüåà';
        else if(state.gender === 'intersex') icon = '‚ößÔ∏è';
        av.innerText = icon;

        // Badges (L√≥gica simple)
        toggleBadge('badge-gender', (state.gender !== 'male' && state.gender !== null));
        toggleBadge('badge-contract', (state.contract === 'contractor' || state.contract === 'outsourced'));
        toggleBadge('badge-ethnic', state.ethnic === 'yes');
        toggleBadge('badge-territory', state.territory === 'rural');
        toggleBadge('badge-peace', state.peace === 'yes');
        toggleBadge('badge-care', state.caregiver === 'yes');
        toggleBadge('badge-neuro', state.neuro === 'yes');
    }

    function toggleBadge(id, show) {
        const el = document.getElementById(id);
        if(show) {
            el.classList.add('visible');
        } else {
            el.classList.remove('visible');
        }
    }

    // AN√ÅLISIS DE RIESGO
    function generateAnalysis() {
        let riskFactors = [];
        let riskScore = 0;

        // L√≥gica de puntuaci√≥n
        if (state.gender === 'female' || state.gender === 'lgbt') { riskFactors.push("G√©nero"); riskScore += 2; }
        if (state.gender === 'intersex') { riskFactors.push("Identidad/Cuerpo"); riskScore += 2; }
        if (state.contract === 'contractor') { riskFactors.push("Contrato OPS"); riskScore += 2; }
        if (state.contract === 'outsourced') { riskFactors.push("Tercerizaci√≥n"); riskScore += 3; }
        if (state.ethnic === 'yes') { riskFactors.push("Racismo"); riskScore += 2; }
        if (state.territory === 'rural') { riskFactors.push("Ruralidad"); riskScore += 1; }
        if (state.peace === 'yes') { riskFactors.push("Estigma Firmante"); riskScore += 2; }
        if (state.caregiver === 'yes') { riskFactors.push("Carga Cuidados"); riskScore += 1; }
        if (state.neuro === 'yes') { riskFactors.push("Neurodivergencia"); riskScore += 1; }

        let resultData = { title: "", icon: "", color: "", text: "" };

        if (riskScore === 0) {
            resultData = { title: "Perfil con 'Escudos' Estructurales", icon: "üõ°Ô∏è", color: "#27ae60", text: "Este perfil cuenta con protecciones. La estabilidad laboral y la ausencia de discriminaci√≥n sist√©mica facilitan el acceso a rutas de justicia." };
        } else if (riskScore <= 3) {
            resultData = { title: "Vulnerabilidad Focalizada", icon: "‚ö†Ô∏è", color: "#f39c12", text: `Existe un riesgo espec√≠fico. Factores como <strong>${riskFactors[0]}</strong> pueden ser usados para intimidar, pero existen ciertos soportes.` };
        } else if (riskScore <= 6) {
            resultData = { title: "Interseccionalidad Compleja", icon: "üõë", color: "#e67e22", text: "Acumulaci√≥n de riesgos significativa. Denunciar pone en peligro la estabilidad econ√≥mica y social de la persona." };
        } else {
            resultData = { title: "Vulnerabilidad Cr√≠tica", icon: "üö®", color: "#c0392b", text: "<strong>Alerta m√°xima.</strong> M√∫ltiples sistemas de opresi√≥n (laboral, racial, g√©nero) act√∫an simult√°neamente. El agresor tiene poder total sobre la v√≠ctima." };
        }

        // Render
        const container = document.getElementById('dynamic-result');
        container.style.borderLeftColor = resultData.color;
        const tagsHtml = riskFactors.map(f => `<span class="tag">${f}</span>`).join('');
        
        container.innerHTML = `
            <div class="result-header">
                <div class="result-icon">${resultData.icon}</div>
                <div>
                    <h3 class="result-title" style="color:${resultData.color}">${resultData.title}</h3>
                    <div class="tags">${tagsHtml}</div>
                </div>
            </div>
            <div class="result-body">${resultData.text}</div>
        `;

        goToSlide(3);
    }
</script>

</body>
</html>
